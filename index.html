<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üèì Ping Pong Scoreboard</title>
    <link rel="stylesheet" href="site.css" />
</head>
<body>
    <div class="container">
        <h1>üèì Ping Pong Scoreboard</h1>

        <form id="matchSetupForm" class="card">
            <label for="player1">Player 1 Name</label>
            <input type="text" id="player1" required />

            <label for="player2">Player 2 Name</label>
            <input type="text" id="player2" required />

            <label for="matchType">Match Type</label>
            <select id="matchType">
                <option value="3">Best of 3</option>
                <option value="5">Best of 5</option>
                <option value="7">Best of 7</option>
            </select>

            <button type="submit">Start Match</button>
        </form>
<br>
        <section class="card mt-4">
            <h2>üìä Player Records</h2>
            <div id="records"></div>
            <button class="danger" onclick="resetRecords()">Reset Records</button>
        </section>
    </div>
<br>
    <section class="card mt-4">
    <h2>üìò Official Ping Pong Rules</h2>
    
    <h3>üéØ Starting the Match</h3>
    <ul>
        <li>The player who serves first is determined by coin toss.</li>
        <li>Winner of the toss can choose to:
            <ul>
                <li>Serve first</li>
                <li>Receive first</li>
                <li>Pick side of the table</li>
            </ul>
        </li>
        <li>The opponent chooses between the remaining options.</li>
    </ul>

    <h3>üèÜ Games are played to 11</h3>
    <ul>
        <li>In competition, games are played best of 5 (first to win 3 games) or best of 7 (first to win 4 games). Social games can also be played best of 3 (first to win 2 games)</li>
        <li>A game is played to 11 points</li>
    </ul>

    <h3>üîÅ Serving Order</h3>
    <ul>
        <li>Service changes every 2 points.</li>
        <li>If score reaches <strong>10-10</strong> (deuce), serve alternates after each point until one player leads by 2.</li>
    </ul>

    <h3>‚úÖ Legal Serving Rules</h3>
    <ul>
        <li>Ball must be thrown straight up from a flat palm at least <strong>6 inches (16 cm)</strong>.</li>
        <li>Serve must be made from behind the table surface ‚Äî not over it.</li>
        <li>The ball must remain visible ‚Äî no part of your body may block it from toss to contact.</li>
        <li>If the ball hits the net on serve (a <em>let</em>), the point is replayed ‚Äî no penalty or <strong>limit.</strong></li>
        <li>NOTE: Once the ball leaves the server's hand it is in play, and so counts as the receiver's point if the ball is missed or mis-hit.</li>
    </ul>

    <h3>üë• Doubles Matches</h3>
    <ul>
        <li>Doubles Serves Must Go Right Court To Right Court.</li>
        <li>The serve must bounce in the server's right court, and receiver's right court (NOTE: landing on center line is fair).</li>
        <li>Doubles partners switch places after their team serves twice.</li>
        <li>Doubles partners must alternate hitting balls in a rally, no matter where the ball lands on the table.</li>
    </ul>

    <h3>‚ùå Volleys Are Not Allowed</h3>
        <ul>
            <li>Can you hit the ball before it bounces? <strong>NO</strong></li>
        </ul>

    <h3>‚ùå You May Not Touch The Table With Your Non-Paddle Hand</h3>

    <h3>‚ùå You May Not Touch The Table With Your Non-Paddle Hand</h3>
        <ul>
            <li>Can you hit the ball before it bounces? <strong>NO</strong></li>
        </ul>


        
</section>

<script>
    document.getElementById('matchSetupForm').addEventListener('submit', function (e) {
        e.preventDefault();
        const p1 = document.getElementById('player1').value.trim();
        const p2 = document.getElementById('player2').value.trim();
        const matchType = document.getElementById('matchType').value;

        if (!p1 || !p2) return;

        window.location.href = `scoreboard.html?p1=${encodeURIComponent(p1)}&p2=${encodeURIComponent(p2)}&match=${matchType}`;
    });

    function showRecords() {
        const data = JSON.parse(localStorage.getItem("playerRecords") || "{}");
        const container = document.getElementById("records");
        container.innerHTML = "";

        if (Object.keys(data).length === 0) {
            container.textContent = "No records yet.";
            return;
        }

        const table = document.createElement("table");
        table.id = "recordsTable";
        table.innerHTML = `
            <thead>
                <tr>
                    <th onclick="sortTable(0)">Player ‚¨ç</th>
                    <th onclick="sortTable(1)">Wins ‚¨ç</th>
                    <th onclick="sortTable(2)">Losses ‚¨ç</th>
                    <th onclick="sortTable(3)">Win % ‚¨ç</th>
                    <th onclick="sortTable(4)">Games Won / Played ‚¨ç</th>
                    <th onclick="sortTable(5)">Streak ‚¨ç</th>
                    <th onclick="sortTable(6)">Last Opponent ‚¨ç</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        `;

        const tbody = table.querySelector("tbody");

        for (const [name, record] of Object.entries(data)) {
            const totalMatches = record.wins + record.losses;
            const winPercent = totalMatches > 0 ? Math.round((record.wins / totalMatches) * 100) : 0;

            const row = document.createElement("tr");
            row.innerHTML = `
                <td>${name}</td>
                <td>${record.wins}</td>
                <td>${record.losses}</td>
                <td>${winPercent}</td>
                <td>${record.gamesWon || 0} / ${record.gamesPlayed || 0}</td>
                <td>${record.streak || "‚Äî"}</td>
                <td>${record.lastOpponent || "‚Äî"}</td>
            `;
            tbody.appendChild(row);
        }

        container.appendChild(table);

        // Add export button
        const exportBtn = document.createElement("button");
        exportBtn.textContent = "Export to CSV";
        exportBtn.className = "btn mt-3";
        exportBtn.onclick = exportTableToCSV;
        container.appendChild(exportBtn);
    }

    function sortTable(colIndex) {
        const table = document.getElementById("recordsTable");
        const tbody = table.tBodies[0];
        const rows = Array.from(tbody.querySelectorAll("tr"));

        const isNumeric = colIndex !== 0 && colIndex !== 4 && colIndex !== 6;

        const sortedRows = rows.sort((a, b) => {
            const aText = a.children[colIndex].textContent;
            const bText = b.children[colIndex].textContent;

            return isNumeric
                ? Number(bText) - Number(aText)
                : aText.localeCompare(bText);
        });

        tbody.innerHTML = "";
        sortedRows.forEach(row => tbody.appendChild(row));
    }

    function exportTableToCSV() {
        const table = document.getElementById("recordsTable");
        const rows = Array.from(table.querySelectorAll("tr"));
        const csv = rows.map(row =>
            Array.from(row.querySelectorAll("td, th"))
                .map(cell => `"${cell.textContent.trim()}"`)
                .join(",")
        ).join("\n");

        const blob = new Blob([csv], { type: "text/csv" });
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = "player-records.csv";
        a.click();
    }

    function resetRecords() {
        localStorage.removeItem("playerRecords");
        showRecords();
    }

    showRecords();
</script>

    
</body>
</html>
